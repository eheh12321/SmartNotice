<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<div th:replace="~{fragment/header :: fragment-header ('보호자 메인 페이지')}"></div>
<body>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <!-- Layout container -->
        <div class="layout-page">
            <!-- Navbar(검색창) -->
            <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                 id="layout-navbar">
                <div class="fw-bold" style="min-width: fit-content">
                    보호자 <span sec:authentication="name"></span> 님
                </div>
                <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                    <ul class="navbar-nav flex-row align-items-center ms-auto">
                        <li class="nav-item">
                            <form action="/logout" method="post" id="logoutForm">
                                <button class="btn" type="submit"
                                        style="background-color: #ff7373; color: white; float: right">
                                    <i class='menu-icon bx bx-log-out'></i>
                                    로그아웃
                                </button>
                                <input type="hidden" name="loginAuth" value="supporter">
                            </form>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- / Navbar(검색창) -->
            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->
                <div class="container-xxl flex-grow-1 container-p-y">
                    <h5 class="pb-1 mb-4">정보 수정</h5>
                    <div class="row">
                        <div class="col-md-6 col-lg-4">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">보호자 정보 수정</h5>
                                    <p class="card-text">보호자 정보를 수정합니다.</p>
                                    <button type="button" class="btn btn-primary" id="supporterUpdateBtn">보호자 정보 수정
                                    </button>
                                    <!-- Modal -->
                                    <div class="modal fade" id="supporterUpdateModal" data-bs-backdrop="static"
                                         tabindex="-1" style="display: none;" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">보호자 정보 수정</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="form-group mb-3">
                                                        <label for="name">이름</label>
                                                        <input type="text" class="form-control" id="name" name="name"
                                                               th:field="${supporter.name}" placeholder="이름">
                                                    </div>
                                                    <div class="form-group mb-3">
                                                        <label for="tel">전화번호</label>
                                                        <input type="text" class="form-control" id="tel" name="tel"
                                                               th:field="${supporter.tel}" placeholder="전화번호">
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <hr>
                                                    <button type="button" class="btn btn-outline-secondary"
                                                            data-bs-dismiss="modal">닫기
                                                    </button>
                                                    <button type="button" class="btn btn-primary"
                                                            id="supporterModalSaveBtn">저장
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /Modal -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="card text-center mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">주민 정보 수정</h5>
                                    <p class="card-text">주민 정보를 수정합니다.</p>
                                    <button type="button" class="btn btn-primary" id="userUpdateBtn">주민 정보 수정</button>
                                    <!-- Modal -->
                                    <div class="modal fade" id="userUpdateModal" data-bs-backdrop="static" tabindex="-1"
                                         style="display: none;" aria-hidden="true">
                                        <div class="modal-dialog text-start">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">주민 정보 수정</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="form-group mb-3">
                                                        <label for="u_name">이름</label>
                                                        <input type="text" class="form-control" id="u_name"
                                                               th:field="${supporter.user.name}" placeholder="이름">
                                                    </div>
                                                    <div class="form-group mb-3">
                                                        <label for="u_tel">전화번호</label>
                                                        <input type="text" class="form-control" id="u_tel"
                                                               th:field="${supporter.user.tel}" placeholder="전화번호">
                                                    </div>
                                                    <div class="form-group mb-3">
                                                        <label for="u_address">주소</label>
                                                        <input type="text" class="form-control" id="u_address"
                                                               th:field="${supporter.user.address}" placeholder="주소">
                                                    </div>
                                                    <div class="form-group mb-3">
                                                        <label for="u_info">특이사항</label>
                                                        <textarea class="form-control" id="u_info"
                                                                  th:field="${supporter.user.info}"
                                                                  placeholder="특이사항 메모"></textarea>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <hr>
                                                    <button type="button" class="btn btn-outline-secondary"
                                                            data-bs-dismiss="modal">닫기
                                                    </button>
                                                    <button type="button" class="btn btn-primary" id="userModalSaveBtn">
                                                        저장
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /Modal -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <div class="card text-end mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">추가 기능??</h5>
                                    <p class="card-text">뭔가 하나 들어가면 딱 좋은데</p>
                                    <a href="javascript:void(0)" class="btn btn-primary">Go somewhere</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 마을 Card -->
                    <div class="row">
                        <div class="col-7">
                            <div class="card">
                                <div class="d-flex align-items-end row">
                                    <div class="card-header">
                                        <h3 class="d-inline ms-2">주민 센서 데이터</h3>
                                        <hr>
                                    </div>
                                    <div class="card-body ms-2">
                                        <div class="row mb-4">
                                            <!-- Chart -->
                                            <div class="col-md">
                                                <canvas id="myChart" width="90vw" height="30vh"></canvas>
                                                <script th:inline="javascript">
                                                    var DATA_COUNT = 7;
                                                    var NUMBER_CFG = {count: DATA_COUNT, min: -100, max: 100};
                                                    var labels = ['월', '화', '수', '목', '금', '토', '일'];
                                                    var data = {
                                                        labels: labels,
                                                        datasets: [
                                                            {
                                                                label: 'Unfilled',
                                                                fill: false,
                                                                backgroundColor: 'rgb(54, 162, 235)',
                                                                borderColor: 'rgb(54, 162, 235)',
                                                                data: [1, 3, 5, 7, 9, 7, 2],
                                                            }, {
                                                                label: 'Dashed',
                                                                fill: false,
                                                                backgroundColor: 'rgb(75, 192, 192)',
                                                                borderColor: 'rgb(75, 192, 192)',
                                                                borderDash: [5, 5],
                                                                data: [7, 6, 5, 4, 3, 2, 1],
                                                            }, {
                                                                label: 'Filled',
                                                                backgroundColor: 'rgb(255, 99, 132)',
                                                                borderColor: 'rgb(255, 99, 132)',
                                                                data: [1, 2, 3, 2, 1, 2, 3],
                                                                fill: true,
                                                            }
                                                        ]
                                                    };
                                                    const ctx = document.getElementById('myChart').getContext('2d');
                                                    const myChart = new Chart(ctx, {
                                                        type: 'line',
                                                        data: data,
                                                        options: {
                                                            responsive: true,
                                                            plugins: {
                                                                title: {
                                                                    display: true,
                                                                    text: 'Chart.js Line Chart'
                                                                },
                                                            },
                                                            interaction: {
                                                                mode: 'index',
                                                                intersect: false
                                                            },
                                                            scales: {
                                                                x: {
                                                                    display: true,
                                                                    title: {
                                                                        display: true,
                                                                        text: 'Month'
                                                                    }
                                                                },
                                                                y: {
                                                                    display: true,
                                                                    title: {
                                                                        display: true,
                                                                        text: 'Value'
                                                                    }
                                                                }
                                                            }
                                                        },
                                                    });
                                                </script>
                                            </div>
                                            <!-- /Chart -->
                                            <!-- Chart -->
                                            <div class="col-md">
                                                <canvas id="myChart2" width="90vw" height="30vh"></canvas>
                                                <script th:inline="javascript">
                                                    var DATA_COUNT = 7;
                                                    var NUMBER_CFG = {count: DATA_COUNT, min: -100, max: 100};
                                                    var labels = ['월', '화', '수', '목', '금', '토', '일'];
                                                    var data = {
                                                        labels: labels,
                                                        datasets: [
                                                            {
                                                                label: 'Unfilled',
                                                                fill: false,
                                                                backgroundColor: 'rgb(54, 162, 235)',
                                                                borderColor: 'rgb(54, 162, 235)',
                                                                data: [1, 3, 5, 7, 9, 7, 2],
                                                            }, {
                                                                label: 'Dashed',
                                                                fill: false,
                                                                backgroundColor: 'rgb(75, 192, 192)',
                                                                borderColor: 'rgb(75, 192, 192)',
                                                                borderDash: [5, 5],
                                                                data: [7, 6, 5, 4, 3, 2, 1],
                                                            }, {
                                                                label: 'Filled',
                                                                backgroundColor: 'rgb(255, 99, 132)',
                                                                borderColor: 'rgb(255, 99, 132)',
                                                                data: [1, 2, 3, 2, 1, 2, 3],
                                                                fill: true,
                                                            }
                                                        ]
                                                    };
                                                    const ctx2 = document.getElementById('myChart2').getContext('2d');
                                                    const myChart2 = new Chart(ctx2, {
                                                        type: 'line',
                                                        data: data,
                                                        options: {
                                                            responsive: true,
                                                            plugins: {
                                                                title: {
                                                                    display: true,
                                                                    text: 'Chart.js Line Chart'
                                                                },
                                                            },
                                                            interaction: {
                                                                mode: 'index',
                                                                intersect: false
                                                            },
                                                            scales: {
                                                                x: {
                                                                    display: true,
                                                                    title: {
                                                                        display: true,
                                                                        text: 'Month'
                                                                    }
                                                                },
                                                                y: {
                                                                    display: true,
                                                                    title: {
                                                                        display: true,
                                                                        text: 'Value'
                                                                    }
                                                                }
                                                            }
                                                        },
                                                    });
                                                </script>
                                            </div>
                                            <!-- /Chart -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-5">
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="card">
                                        <div class="d-flex align-items-end row">
                                            <div class="card-header">
                                                <h3 class="d-inline ms-2">보호자 정보</h3>
                                                <hr>
                                            </div>
                                            <div class="card-body ms-2">
                                                <div class="row">
                                                    <div class="col-md" th:object="${supporter}">
                                                        <div class="form-group mb-4">
                                                            <label for="s_name">이름</label>
                                                            <input type="text" class="form-control"
                                                                   id="s_name" placeholder="name" th:field="*{name}"
                                                                   readonly>
                                                        </div>
                                                        <div class="form-group mb-4">
                                                            <label for="s_tel">전화번호</label>
                                                            <input type="text" class="form-control"
                                                                   id="s_tel" placeholder="tel" th:field="*{tel}"
                                                                   readonly>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="card">
                                        <div class="d-flex align-items-end row">
                                            <div class="card-header">
                                                <h3 class="d-inline ms-2">최근 긴급 알림 목록</h3>
                                                <hr>
                                            </div>
                                            <div class="card-body ms-2">
                                                <div class="row mb-4">
                                                    <div class="col-md">
                                                        <table class="table table-bordered table-hover" id="alertTable">
                                                            <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>호출 시각</th>
                                                                <th>분류</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr th:each="alert : ${alertList}">
                                                                <td th:text="${alert.id}">1</td>
                                                                <td th:text="${#temporals.format(alert.alertTime, 'yy/MM/dd HH:mm:ss')}">
                                                                    1
                                                                </td>
                                                                <td>사용자 호출</td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /마을 Card-->
                </div>
                <!-- / Content -->
                <!-- footer -->
                <div th:replace="~{fragment/footer.html :: fragment-footer}"></div>
                <!-- / footer -->
            </div>
            <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
    </div>
    <!-- Overlay -->
</div>
<!-- / Layout wrapper -->
<script type="text/javascript" th:inline="javascript">
    $(document).ready(function () {
        $("#alertTable").DataTable();
        $("#supporterUpdateBtn").on("click", function () {
            $("#supporterUpdateModal").modal('show');
        });
        $("#userUpdateBtn").on("click", function () {
            $("#userUpdateModal").modal('show');
        });
        $("#supporterModalSaveBtn").on("click", function () {
            var id = [[${supporter.id}]];
            var name = $("input[name='name']").val();
            var tel = $("input[name='tel']").val();
            if (name.replace(/\s/gi, "").length == 0) {
                alert("이름을 입력해주세요");
                return false;
            }
            if (tel.replace(/\s/gi, "").length == 0) {
                alert("전화번호를 입력해주세요");
                return false;
            }
            if (confirm("정보를 수정하시겠습니까??")) {
                $.ajax({
                    type: "PUT",
                    url: "/s/supporter",
                    data: {name: name, tel: tel, id: id},
                    dataType: "text",
                    success: function (result) {
                        alert(result);
                        window.location.href = "/s";
                    },
                    error: function (xhr) {
                        alert(xhr.responseText);
                    }
                });
            } else {
                return false;
            }
        });

        $("#userModalSaveBtn").on("click", function () {
            var id = [[${supporter.user.id}]];
            var name = $("#u_name").val();
            var tel = $("#u_tel").val();
            var address = $("#u_address").val();
            var info = $("#u_info").val();
            if (name.replace(/\s/gi, "").length == 0) {
                alert("이름을 입력해주세요");
                return false;
            }
            if (tel.replace(/\s/gi, "").length == 0) {
                alert("전화번호를 입력해주세요");
                return false;
            }
            if (address.replace(/\s/gi, "").length == 0) {
                alert("주소를 입력해주세요");
                return false;
            }
            if (confirm("정보를 수정하시겠습니까??")) {
                $.ajax({
                    type: "PUT",
                    url: "/s/user",
                    data: {name: name, tel: tel, id: id, address: address, info: info},
                    dataType: "text",
                    success: function (result) {
                        alert(result);
                        window.location.href = "/s";
                    },
                    error: function (xhr) {
                        alert(xhr.responseText);
                    }
                });
            } else {
                return false;
            }
        });
    });
</script>
<div th:replace="~{fragment/header :: fragment-bottom-script}"></div>
</body>
</html>
